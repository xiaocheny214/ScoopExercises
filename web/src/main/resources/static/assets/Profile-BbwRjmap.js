import{u as M,r as _,a as P,p as S,g as j,n as A,c as D,b as o,d as s,w as a,f,t as I,h as n,o as Z,j as g,a7 as L,E as w,a0 as O}from"./index-BVGhpotA.js";import{C as G}from"./CatIcon-Cpp1lzg_.js";import{a as k}from"./format-XwD1px1m.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"profile-container"},K={class:"profile-header"},Q={class:"header-left"},W={class:"profile-content"},X={class:"info-card"},Y={class:"card-header"},ee={class:"avatar-section"},se={class:"user-avatar"},oe={class:"user-basic"},ae={class:"user-account"},le={class:"user-time"},re={class:"card-content"},te={class:"tab-content"},ne={class:"tab-content"},de={__name:"Profile",setup(ue){const v=j(),l=M(),x=_("basic"),V=_(!1),y=_(!1),U=_(null),h=_(null),u=P({account:"",nickName:""}),r=P({oldPassword:"",newPassword:"",confirmPassword:""}),R=P({nickName:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在1-50个字符",trigger:"blur"}]}),T=P({oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度至少8个字符",trigger:"blur"},{validator:(i,e,c)=>{e&&!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{8,}$/.test(e)?c(new Error("密码必须包含大写字母、小写字母、数字和特殊字符")):c()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(i,e,c)=>{e!==r.newPassword?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]}),B=()=>{v.push("/home")},b=()=>{u.account=l.userInfo.account,u.nickName=l.userInfo.nickName},E=()=>{b()},N=()=>{Object.assign(r,{oldPassword:"",newPassword:"",confirmPassword:""}),h.value?.clearValidate()},q=async()=>{if(await U.value.validate()){V.value=!0;try{const e=await l.updateUserInfo(u);e.success?(w.success(e.message),b()):w.error(e.message)}catch{w.error("更新用户信息失败")}finally{V.value=!1}}},$=async()=>{if(await h.value.validate()){y.value=!0;try{const e=await l.resetPassword({account:l.userInfo.account,oldPassword:r.oldPassword,newPassword:r.newPassword});e.success?(w.success(e.message),N(),O.confirm("密码修改成功，需要重新登录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(()=>{l.clearUserInfo(),v.push("/login")}).catch(()=>{l.clearUserInfo(),v.push("/login")})):w.error(e.message)}catch{w.error("密码修改失败")}finally{y.value=!1}}};return S(()=>{if(l.initUserInfo(),!l.isLoggedIn){v.push("/login");return}b()}),A(()=>l.userInfo,i=>{i&&i.account&&b()},{deep:!0}),(i,e)=>{const c=f("el-icon"),p=f("el-button"),m=f("el-input"),d=f("el-form-item"),C=f("el-form"),F=f("el-tab-pane"),z=f("el-tabs");return Z(),D("div",J,[o("div",K,[o("div",Q,[s(p,{onClick:B,type:"text"},{default:a(()=>[s(c,null,{default:a(()=>[s(n(L))]),_:1}),e[6]||(e[6]=g(" 返回首页 ",-1))]),_:1})]),e[7]||(e[7]=o("h2",null,"个人信息",-1)),e[8]||(e[8]=o("div",{class:"header-right"},null,-1))]),o("div",W,[o("div",X,[o("div",Y,[o("div",ee,[o("div",se,[s(G,{"cat-size":"80px"})]),o("div",oe,[o("h3",null,I(n(l).userInfo.nickName||n(l).userInfo.account),1),o("p",ae,"账号："+I(n(l).userInfo.account),1),o("p",le,"注册时间："+I(n(k)(n(l).userInfo.createTime)),1)])])]),o("div",re,[s(z,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),class:"profile-tabs"},{default:a(()=>[s(F,{label:"基本信息",name:"basic"},{default:a(()=>[o("div",te,[s(C,{model:u,rules:R,ref_key:"userFormRef",ref:U,"label-width":"100px",class:"user-form"},{default:a(()=>[s(d,{label:"账号"},{default:a(()=>[s(m,{modelValue:u.account,"onUpdate:modelValue":e[0]||(e[0]=t=>u.account=t),disabled:""},null,8,["modelValue"])]),_:1}),s(d,{label:"昵称",prop:"nickName"},{default:a(()=>[s(m,{modelValue:u.nickName,"onUpdate:modelValue":e[1]||(e[1]=t=>u.nickName=t),placeholder:"请输入昵称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(d,{label:"创建时间"},{default:a(()=>[s(m,{value:n(k)(n(l).userInfo.createTime),disabled:""},null,8,["value"])]),_:1}),s(d,{label:"最后登录"},{default:a(()=>[s(m,{value:n(k)(n(l).userInfo.loginTime),disabled:""},null,8,["value"])]),_:1}),s(d,null,{default:a(()=>[s(p,{type:"primary",onClick:q,loading:V.value},{default:a(()=>[...e[9]||(e[9]=[g(" 保存修改 ",-1)])]),_:1},8,["loading"]),s(p,{onClick:E},{default:a(()=>[...e[10]||(e[10]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1}),s(F,{label:"密码修改",name:"password"},{default:a(()=>[o("div",ne,[s(C,{model:r,rules:T,ref_key:"passwordFormRef",ref:h,"label-width":"100px",class:"password-form"},{default:a(()=>[s(d,{label:"当前密码",prop:"oldPassword"},{default:a(()=>[s(m,{modelValue:r.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>r.oldPassword=t),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),s(d,{label:"新密码",prop:"newPassword"},{default:a(()=>[s(m,{modelValue:r.newPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>r.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),e[11]||(e[11]=o("div",{class:"password-tips"},[o("p",null,"密码要求："),o("ul",null,[o("li",null,"至少8个字符"),o("li",null,"包含大写字母、小写字母、数字和特殊字符"),o("li",null,`支持的特殊字符：!@#$%^&*()_+-=[]{}|;':\\",./<>?`)])],-1))]),_:1}),s(d,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[s(m,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>r.confirmPassword=t),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),s(d,null,{default:a(()=>[s(p,{type:"primary",onClick:$,loading:y.value},{default:a(()=>[...e[12]||(e[12]=[g(" 修改密码 ",-1)])]),_:1},8,["loading"]),s(p,{onClick:N},{default:a(()=>[...e[13]||(e[13]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1},8,["modelValue"])])])])])}}},pe=H(de,[["__scopeId","data-v-30e4645a"]]);export{pe as default};
