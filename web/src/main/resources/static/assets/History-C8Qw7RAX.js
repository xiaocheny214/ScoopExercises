import{r as S,a as E,m as x,n as re,p as ie,E as g,c as B,b as o,d as e,w as l,f as r,j as p,g as ce,D as de,o as y,h as d,a7 as ue,s as pe,Q as M,R as T,q as D,V as _e,C as me,X as fe,t as c,J as Y,Y as ge,S as he,W as ve,a0 as P}from"./index-BVGhpotA.js";import{u as ye}from"./history-CxXN_IVo.js";import{u as be}from"./questionBank-BoZwulwO.js";import{b as ke,a as we}from"./format-XwD1px1m.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Se={class:"history-container"},xe={class:"page-header"},Be={class:"header-content"},De={class:"header-top"},ze={class:"page-title"},Ie={class:"filter-section"},Ve={class:"content-section"},He={class:"toolbar"},Ee={class:"toolbar-left"},Me={class:"total-count"},Te={class:"toolbar-right"},Ye={class:"bank-paper-info"},Pe={class:"bank-name"},qe={class:"paper-name"},Le={class:"score-info"},Ne={class:"score-percentage"},Ue={class:"answer-info"},Qe={class:"answer-count"},Re={class:"time-info"},je={class:"pagination-wrapper"},Oe={__name:"History",setup($e){const z=ce(),b=ye(),k=be(),w=S(!1),m=S([]),h=S([]),u=E({bankId:null,paperId:null,orderBy:"createTime",sortOrder:"DESC"}),n=E({page:1,size:10,totalElements:0,totalPages:0}),q=x(()=>b.historyList),L=x(()=>k.questionBanks),N=x(()=>k.papers);re(()=>u.bankId,s=>{u.paperId=null,s&&k.getPapersByBankId(s)}),ie(async()=>{await U(),await f()});const U=async()=>{try{await k.getQuestionBanks()}catch(s){console.error("加载题库列表失败:",s)}},f=async()=>{w.value=!0;try{const s={page:n.page-1,size:n.size,...u};m.value&&m.value.length===2&&(s.startDate=m.value[0],s.endDate=m.value[1]);const a=await b.getHistoryList(s);a.success&&(n.totalElements=a.data.totalElements,n.totalPages=a.data.totalPages)}catch{g.error("加载历史记录失败")}finally{w.value=!1}},Q=()=>{n.page=1,f()},R=()=>{Object.assign(u,{bankId:null,paperId:null,orderBy:"createTime",sortOrder:"DESC"}),m.value=[],n.page=1,f()},j=s=>{n.size=s,n.page=1,f()},O=s=>{n.page=s,f()},$=s=>{z.push({name:"HistoryDetail",params:{id:s},query:{from:"history"}})},F=s=>{h.value=s.map(a=>a.id)},J=async s=>{try{await P.confirm("确定要删除这条历史记录吗？删除后无法恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await b.deleteHistory(s);a.success?(g.success("删除成功"),await f()):g.error(a.message||"删除失败")}catch(a){a!=="cancel"&&g.error("删除失败")}},W=async()=>{try{await P.confirm(`确定要删除选中的 ${h.value.length} 条历史记录吗？删除后无法恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=await b.batchDeleteHistory(h.value);s.success?(g.success("批量删除成功"),h.value=[],await f()):g.error(s.message||"批量删除失败")}catch(s){s!=="cancel"&&g.error("批量删除失败")}},X=()=>{z.back()},A=(s,a)=>{const i=s/a*100;return i>=90?"score-excellent":i>=80?"score-good":i>=60?"score-pass":"score-fail"},G=s=>({0:"info",1:"success",2:"warning"})[s]||"info",K=s=>({0:"未完成",1:"已完成",2:"部分完成"})[s]||"未知";return(s,a)=>{const i=r("el-icon"),v=r("el-button"),I=r("el-option"),V=r("el-select"),C=r("el-form-item"),Z=r("el-date-picker"),ee=r("el-form"),H=r("el-card"),_=r("el-table-column"),te=r("el-progress"),ae=r("el-tag"),se=r("el-table"),le=r("el-pagination"),oe=de("loading");return y(),B("div",Se,[o("div",xe,[o("div",Be,[o("div",De,[e(v,{onClick:X,type:"text",class:"back-button"},{default:l(()=>[e(i,null,{default:l(()=>[e(d(ue))]),_:1}),a[5]||(a[5]=p(" 返回 ",-1))]),_:1})]),o("h1",ze,[e(i,null,{default:l(()=>[e(d(pe))]),_:1}),a[6]||(a[6]=p(" 历史记录 ",-1))]),a[7]||(a[7]=o("p",{class:"page-subtitle"},"查看您的答题历史记录",-1))])]),o("div",Ie,[e(H,{shadow:"never",class:"filter-card"},{default:l(()=>[e(ee,{model:u,inline:"",class:"filter-form"},{default:l(()=>[e(C,{label:"题库"},{default:l(()=>[e(V,{modelValue:u.bankId,"onUpdate:modelValue":a[0]||(a[0]=t=>u.bankId=t),placeholder:"选择题库",clearable:"",style:{width:"200px"}},{default:l(()=>[(y(!0),B(M,null,T(L.value,t=>(y(),D(I,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"试卷"},{default:l(()=>[e(V,{modelValue:u.paperId,"onUpdate:modelValue":a[1]||(a[1]=t=>u.paperId=t),placeholder:"选择试卷",clearable:"",style:{width:"200px"}},{default:l(()=>[(y(!0),B(M,null,T(N.value,t=>(y(),D(I,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"时间范围"},{default:l(()=>[e(Z,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=t=>m.value=t),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),e(C,null,{default:l(()=>[e(v,{type:"primary",onClick:Q,loading:w.value},{default:l(()=>[e(i,null,{default:l(()=>[e(d(_e))]),_:1}),a[8]||(a[8]=p(" 搜索 ",-1))]),_:1},8,["loading"]),e(v,{onClick:R},{default:l(()=>[e(i,null,{default:l(()=>[e(d(me))]),_:1}),a[9]||(a[9]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),o("div",Ve,[e(H,{shadow:"never",class:"content-card"},{default:l(()=>[o("div",He,[o("div",Ee,[o("span",Me,"共 "+c(n.totalElements)+" 条记录",1)]),o("div",Te,[e(v,{type:"danger",disabled:h.value.length===0,onClick:W},{default:l(()=>[e(i,null,{default:l(()=>[e(d(Y))]),_:1}),p(" 批量删除 ("+c(h.value.length)+") ",1)]),_:1},8,["disabled"])])]),fe((y(),D(se,{data:q.value,onSelectionChange:F,class:"history-table",height:"450",style:{width:"100%"}},{default:l(()=>[e(_,{type:"selection",width:"55"}),e(_,{prop:"id",label:"记录ID",width:"100"}),e(_,{label:"题库/试卷","min-width":"200"},{default:l(({row:t})=>[o("div",Ye,[o("div",Pe,c(t.bankName||"未知题库"),1),o("div",qe,c(t.paperName||"未知试卷"),1)])]),_:1}),e(_,{label:"成绩",width:"120",align:"center"},{default:l(({row:t})=>[o("div",Le,[o("div",{class:ge(["score-value",A(t.totalScore,t.maxScore)])},c(t.totalScore)+"/"+c(t.maxScore),3),o("div",Ne,c(d(ke)(t.totalScore,t.maxScore)),1)])]),_:1}),e(_,{label:"答题情况",width:"120",align:"center"},{default:l(({row:t})=>[o("div",Ue,[o("div",Qe,c(t.answeredCount)+"/"+c(t.totalCount),1),e(te,{percentage:t.answeredCount/t.totalCount*100,"show-text":!1,"stroke-width":6},null,8,["percentage"])])]),_:1}),e(_,{label:"答题时间",width:"180"},{default:l(({row:t})=>[o("div",Re,[e(i,null,{default:l(()=>[e(d(he))]),_:1}),p(" "+c(d(we)(t.createTime)),1)])]),_:1}),e(_,{label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[e(ae,{type:G(t.status)},{default:l(()=>[p(c(K(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"操作",width:"180",fixed:"right"},{default:l(({row:t})=>[e(v,{type:"primary",size:"small",onClick:ne=>$(t.id)},{default:l(()=>[e(i,null,{default:l(()=>[e(d(ve))]),_:1}),a[10]||(a[10]=p(" 查看详情 ",-1))]),_:1},8,["onClick"]),e(v,{type:"danger",size:"small",onClick:ne=>J(t.id)},{default:l(()=>[e(i,null,{default:l(()=>[e(d(Y))]),_:1}),a[11]||(a[11]=p(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,w.value]]),o("div",je,[e(le,{"current-page":n.page,"onUpdate:currentPage":a[3]||(a[3]=t=>n.page=t),"page-size":n.size,"onUpdate:pageSize":a[4]||(a[4]=t=>n.size=t),"page-sizes":[10,20,50,100],total:n.totalElements,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1})])])}}},Ge=Ce(Oe,[["__scopeId","data-v-579b3a1a"]]);export{Ge as default};
